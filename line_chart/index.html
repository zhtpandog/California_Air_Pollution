<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>line</title>
		<script type="text/javascript" src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
		<style type="text/css">
			/* No style rules here yet */
		</style>
	</head>
	<body>

		<div class="line"></div>

		<script type="text/javascript">

			var w = 1000;
			var h = 600;
			var padding = 100
			var timestamp = ['00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:00']

			interval = (w - 2 * padding) / 23
			xRange = []
			for (var i = 0; i < timestamp.length; i++) {
				xRange.push(padding + interval * i);
			}


			d3.json("line_example.json", function(json) {

				var no2 = parseAirDataOneDayPerPt(json, "0009", "2017-01-01", "NO2");
				var so2 = parseAirDataOneDayPerPt(json, "0009", "2017-01-01", "SO2");
				var co = parseAirDataOneDayPerPt(json, "0009", "2017-01-01", "CO");
				var ozone = parseAirDataOneDayPerPt(json, "0009", "2017-01-01", "Ozone");
	            createLine(so2, co, ozone);

            })

            function parseAirDataOneDayPerPt(data, point, date, pol) {

            	var parseTime = d3.timeParse("%Y-%m-%d %H:%M")

            	temp = data[point][pol][date];
            	timeAndVal = [];
            	for (i in temp) {
            		timeAndVal.push([i, parseFloat(temp[i])]);
            	}
            	timeAndVal.sort();

            	dateTimeAndVal = [];
            	for (var i = 0; i < timeAndVal.length; i++) {
            		dateTimeAndVal.push([parseTime(date + " "+ timeAndVal[i][0]), timeAndVal[i][1]]);
            	}

            	return dateTimeAndVal;
            	
            }

            var createLine = function(data, data2, data3, data4) {

            	if (typeof data2 == "undefined") { // only consider data
            		yExtent = d3.extent(data, function(d) {return +d[1];});
            	}
            	else if (typeof data3 == "undefined") { // consider data and data2
            		ye1 = d3.extent(data, function(d) {return d[1];});
            		ye2 = d3.extent(data2, function(d) {return d[1];});
            		yExtent = [Math.min(ye1[0], ye2[0]), Math.max(ye1[1], ye2[1])];
            	}
            	else if (typeof data4 == "undefined") { // consider data and data2
            		ye1 = d3.extent(data, function(d) {return d[1];});
            		ye2 = d3.extent(data2, function(d) {return d[1];});
            		ye3 = d3.extent(data3, function(d) {return d[1];});
            		yExtent = [Math.min(ye1[0], ye2[0], ye3[0]), Math.max(ye1[1], ye2[1], ye3[1])];
            	}
            	else {
            		ye1 = d3.extent(data, function(d) {return d[1];});
            		ye2 = d3.extent(data2, function(d) {return d[1];});
            		ye3 = d3.extent(data3, function(d) {return d[1];});
            		ye4 = d3.extent(data4, function(d) {return d[1];});
            		yExtent = [Math.min(ye1[0], ye2[0], ye3[0], ye4[0]), Math.max(ye1[1], ye2[1], ye3[1], ye4[1])];
            	}

            	var w = 1000;
				var h = 600;

            	var svg = d3.select("body")
	            			.select(".line")
	            			.append("svg")
	            			.attr("width", w)
	            			.attr("height", h)

			    margin = {top: 20, right: 20, bottom: 30, left: 50},
			    width = w - margin.left - margin.right,
			    height = h - margin.top - margin.bottom,
			    g = svg.append("g")
			    		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			    var x = d3.scaleTime()
			    			.domain(d3.extent(data, function(d) {return d[0];}))
			    			.rangeRound([0, width]);

			    var y = d3.scaleLinear()
			    			.domain(yExtent)
			    			.rangeRound([height, 0]);

			    var line = d3.line()
			    				.x(function(d) {return x(d[0])})
			    				.y(function(d) {return y(+d[1])});


			    g.append("g")
			      .attr("transform", "translate(0," + height + ")")
			      .call(d3.axisBottom(x))
			      .select(".domain");
			      // .remove();

			  g.append("g")
			      .call(d3.axisLeft(y))
			      .append("text")
			      .attr("fill", "#000")
			      .attr("transform", "rotate(-90)")
			      .attr("y", 6)
			      .attr("dy", "0.71em")
			      .attr("text-anchor", "end")
			      .text("read");

			  g.append("path")
			      .datum(data)
			      .attr("fill", "none")
			      .attr("stroke", "steelblue")
			      .attr("stroke-linejoin", "round")
			      .attr("stroke-linecap", "round")
			      .attr("stroke-width", 1.5)
			      .attr("d", line);

			  if (typeof data2 != "undefined") {
				  g.append("path")
				      .datum(data2)
				      .attr("fill", "none")
				      .attr("stroke", "red")
				      .attr("stroke-linejoin", "round")
				      .attr("stroke-linecap", "round")
				      .attr("stroke-width", 1.5)
				      .attr("d", line);
			  }

			  if (typeof data3 != "undefined") {
				  g.append("path")
				      .datum(data3)
				      .attr("fill", "none")
				      .attr("stroke", "magenta")
				      .attr("stroke-linejoin", "round")
				      .attr("stroke-linecap", "round")
				      .attr("stroke-width", 1.5)
				      .attr("d", line);
			  }

			  if (typeof data4 != "undefined") {
				  g.append("path")
				      .datum(data4)
				      .attr("fill", "none")
				      .attr("stroke", "orange")
				      .attr("stroke-linejoin", "round")
				      .attr("stroke-linecap", "round")
				      .attr("stroke-width", 1.5)
				      .attr("d", line);
			  }


            }
			
		</script>
	</body>
</html>