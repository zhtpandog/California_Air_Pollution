<html>
    <head>
    	<h1>Population Facts for 10 Countries</h1>
    	<p>This page offers visualizations for population facts for 10 countries. Data used in this webpage is the population count (in thousands) for 10 countries (Australia, China, France, Germany, India, Japan, Nigeria, Russian Federation, United Kingdom, and United States of America) from 1950 to 2005 with a 5-year interval. The original data is downloaded from UN Data (data.un.org), with a specific title of "Total population, both sexes combined (thousands)".</p>

        <script type="text/javascript" src="http://d3js.org/d3.v4.min.js"></script>

        <style>


        body.tbl{
            font-family: Arial;
        }
        h1.tbl{
            color: #0099FF;
        }
        p.tbl{
            color: #ff0000;
        }
        tr.tbl{
            background-color: #ccccff;

        }
        td.tbl{
            background-color: #ccccff;

        }
        table.tbl{
            color: #000000;
            text-align: center;
            font-family: Arial;
        }
        

        td.tbl1,th.tbl1 {
            padding: 2px 15px;
            text-align: center;
            background-color: #9999ff;

        }

        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }

        .axis text {
            font-family: sans-serif;
            font-size: 11px;
        }

        .container {
		  float: left;
		}
        </style>

    </head>
        
    <body>
    	<h1>Table</h1>
    	<p>The table displays the population (in thousands) data for 10 countries between 1950 and 2005 with a five year interval.</p>
    	<div class="table"></div>

    	<h1>Scatter Plot</h1>
    	<p>The scatter plot displays the population (in thousands) for each country from 1950 to 2005 with a five year interval. Different countries are represented using different colors, and the circle size is proportional to the population number.</p>
    	<div class="scatter"></div>

    	<h1>Bar Chart</h1>
    	<p>The bar chart displays the population data (in thousands) for 10 countries in 1950. The bars are presented in a sorted way, and the higher the bar, the larger the value. The color is like pouring the same amount of paint to a container with size of the bar.</p>
    	<div class="bar"></div>

    	<h1>Slope Graph</h1>
    	<p>The slope graph displays the population (in thousands) change for 10 countries between year 1950 and 1955. The higher the position, the larger the value. Countries are differentiated by colors.</p>
    	<div class="slope"></div>

        <script type="text/javascript">

        	var colorFill = {'Australia': '#FF69B4', 'USA':'#DDA0DD', 'India':'#E9967A', 'France':'#FF7F50', 'UK':'#FFD700', 'China':'#006400', 'Germany':'#00CED1', 'Russia':'#0000FF', 'Japan':'#808000', 'Nigeria':'#808080'}

        	var yearList = ['1950', '1955', '1960', '1965', '1970', '1975', '1980', '1985', '1990', '1995', '2000', '2005']


            d3.json("data.json", function(json) {

	            year1950 = [];
	            for (i in json) {
	            	year1950.push([i, json[i][0][1]]);
	            }

	            // sort from large to small
	            year1950.sort(function(first, second) {
	            	return  second[1] - first[1];
	            })

	            tbl_data = []
	            for (var i = 1950; i <= 2005; i += 5) {
	            	tbl_data.push({"Yr/Country": i.toString()});
	            }

	            countries = ["Yr/Country"]
	            for (i in json) {
	            	countries.push(i);
	
					cnt = 0;
					len = json[i].length;
	            	for (var j = 0; j < len; j++) {
	            		tbl_data[j][i] = json[i][j][1];
	            	}
	            }

	            createTable(tbl_data, countries);
            	createScatter(json);
            	console.log(json);
            	createSlope(json);
            	createBar(year1950);
            })

            var createTable = function(data, columns) {
            	var table = d3.select("body").select(".table").append("table").classed("tbl", true);
            	var thead = table.append("thead").classed("tbl", true);
            	var tbody = table.append("tbody").classed("tbl", true);

            	thead.append("tr")
            			.selectAll("th")
            			.data(columns)
            			.enter()
            			.append("th")
            			.text(function(d) {return d;})
            			.classed("tbl1", true);

            	var rows = tbody.selectAll("tr")
            						.data(data)
            						.enter()
            						.append("tr")
            						.classed("tbl", true);

            	var cells = rows.selectAll("td")
            					.data(function (row) {
            						return columns.map(function(column) {
            							return {column: column, value: row[column]};
            						})
            					})
            					.enter()
            					.append("td")
            					.text(function (d) {
            						return d.value;
            					})
            					.classed("tbl", true);


            }

            var createBar = function(year) {
            	var w = 800;
	            var h = 600;
	            var padding = 100;
	            var barPadding = 20;
	            // var interval = (w - padding) / year.length;

	            var barWid = ((w - padding) / year.length) - barPadding;
	            var interval = barWid + barPadding;


	            xRange = []
	            for (var i = 0; i < year.length; i++) {
	            	xRange.push(padding + 0.5 * barWid + interval * i);
	            }

	            countryListSort = []
	            for (i in year) {
	            		countryListSort.push(year[i][0]);
	            }

	            var xScale = d3.scaleOrdinal()
	            				.domain(countryListSort)
	            				.range(xRange);

	            var yScale = d3.scaleLinear()
	            				.domain([0, d3.max(year, function(d) {return d[1];})])
	            				.range([h - padding, padding]);

	            var svg = d3.select("body")
	            			.select(".bar")
	                        .append("svg")
	                        .attr("width", w)
	                        .attr("height", h);

	            svg.selectAll("rect")
	            	.data(year)
	            	.enter()
	            	.append("rect")
	            	.attr("x", function(d) {
	                    return xScale(d[0]) - 0.5 * barWid;
	               	})
	               	.attr("y", function(d) {
	                    return yScale(d[1]);
	               	})
	                .attr("width", barWid)
	                .attr("height", function(d) {
	                	return h - padding - yScale(d[1]);
	                })
	                .attr("fill", function(d) {
	                	return "rgb(0, " + (Math.round((h - padding - yScale(d[1])) / 1.5)) + ", 0)";
	                })

	            var xAxis = d3.axisBottom()
	                            .scale(xScale);


	            svg.append("g")
	                .attr("class", "axis")
	                .attr("transform", "translate(0," + (h-padding) + ")")
	                .call(xAxis);

	            svg.append("text")             
				      .attr("transform",
				            "translate(" + (w/2) + " ," + 
				                           (h - padding / 2) + ")")
				      .style("text-anchor", "middle")
				      .text("Country");


	            svg.append("text")
			        .attr("transform", "rotate(-90)")
			        .attr("y", padding / 5)
			        .attr("x",0 - (h / 2))
			        .attr("dy", "1em")
			        .style("text-anchor", "middle")
			        .text("Population (k)");

			    var yAxis = d3.axisLeft()
	                            .scale(yScale);



	            svg.append("g")
	                .attr("class", "axis")
	                .attr("transform", "translate(" + padding + ",0)")
	                .call(yAxis);


            }

            var createScatter = function(json) {

	            var w = 1000;
	            var h = 600;
	            var wLegend = 100;
	            var hLegend = 100;
	            var padding = 100;
	            var rMin = 2;
	            var rMax = 10;
	            var legendWidth = 50;
	        	var legendHeight = 20;
	        	var legendPadding = 20;
	        	var interval = (w - wLegend - padding * 3) / (yearList.length - 1)

	        	xRange = []
	        	for (var i = 0; i < yearList.length; i++) {
	        		xRange.push(padding + interval * i);
	        	}

	        	allTuples = [];
	            countryList = [];
	            for (i in json) {
	            	for (var j = 0; j < json[i].length; j++) {
	            		allTuples.push([+json[i][j][0], +json[i][j][1], i]);
	            	}
	            	countryList.push(i);
	            }

	            var xScale = d3.scaleOrdinal()
	            				.domain(yearList)
	            				.range(xRange)

	            var yScale = d3.scaleLinear()
	                            .domain([0, d3.max(allTuples, function(d) {return d[1];})])
	                            .range([h - padding, padding]);

	            var rScale = d3.scaleLinear()
	                            .domain([0, d3.max(allTuples, function(d) { return d[1]; })])
	                            .range([rMin, rMax]);

	             //Create SVG element
	            var svg = d3.select("body")
	            			.select(".scatter")
	                        .append("svg")
	                        .attr("width", w)
	                        .attr("height", h);
	                        

	            svg.selectAll("circle")  
	               .data(allTuples)
	               .enter()
	               .append("circle")    
	               .attr("cx", function(d) {
	                    return xScale(d[0]);
	               })
	               .attr("cy", function(d) {
	                    return yScale(d[1]);
	               })
	               .attr("r", function(d) {
	                    return rScale(d[1]);
	                })
	               .style("fill", function(d) {
	               		return colorFill[d[2]];
	               });


	            svg.selectAll("rect")  
	               .data(countryList)
	               .enter()
	               .append("rect")
	               .attr("x", w - wLegend * 2.5)
	               .attr("y", function(d, i) {
	                    return hLegend + i * (legendHeight + legendPadding);
	               })
	               .attr("width", legendWidth)
	               .attr("height", legendHeight)
	               .style("fill", function(d, i) {
	               		return colorFill[countryList[i]];
	               });

	            svg.selectAll("text")  
	               .data(countryList)
	               .enter()
	               .append("text")
	               .text(function(d) {return d;})
	               .attr("x", w - wLegend * 1.9)
	               .attr("y", function(d, i) {
	                    return 15 + hLegend + i * (legendHeight + legendPadding);
	               })
	               .attr('font-family', 'sans-serif')
                   .attr('font-size', '12px')
                   .style('font-weight', 'bold');
                   

	            var xAxis = d3.axisBottom()
	                            .scale(xScale);

	            svg.append("text")             
				      .attr("transform",
				            "translate(" + (w/2.5) + " ," + 
				                           (h - padding / 2) + ")")
				      .style("text-anchor", "middle")
				      .text("Year");


	            svg.append("text")
			        .attr("transform", "rotate(-90)")
			        .attr("y", padding / 5)
			        .attr("x",0 - (h / 2))
			        .attr("dy", "1em")
			        .style("text-anchor", "middle")
			        .text("Population (k)");

	            svg.append("g")
	                .attr("class", "axis")
	                .attr("transform", "translate(0," + (h-padding) + ")")
	                .call(xAxis);

	            var yAxis = d3.axisLeft()
	                            .scale(yScale);

	            svg.append("g")
	                .attr("class", "axis")
	                .attr("transform", "translate(" + padding + ",0)")
	                .call(yAxis);

	            
	        }

	        var createSlope = function(json) {

	            var w = 1000;
	            var h = 1000;
	            var padding = 100;

	        	//
	        	prepare = []
	        	y1955 = []
	        	for (var i in json) {
	        		prepare.push([json[i][0][0], json[i][0][1], i]);
	        		prepare.push([json[i][1][0], json[i][1][1], i]);
	        		y1955.push(+json[i][1][1])
	        	}

	            xRange = [padding, w - padding *5];

	            var xScale = d3.scaleOrdinal()
	            				.domain(["1950", "1955"])
	            				.range(xRange)

	            var yScale2 = d3.scaleLinear()
	                            .domain([0, d3.max(y1955, function(d) {return d;})])
	                            .range([h - padding, padding]);

	             //Create SVG element
	            var svg = d3.select("body")
	            			.select(".slope")
	                        .append("svg")
	                        .attr("width", w)
	                        .attr("height", h);

	            svg.selectAll("text")  
	               .data(prepare)
	               .enter()
	               .append("text")
	               .text(function(d) {
	               		if (d[0] == "1950") {
	               			return d[2] + " " + d[1];
	               		} else {
	               			return d[1] + " " + d[2];
	               		}
	               })
	               .attr("x", function(d) {
	               		return xScale(d[0]);
	               })
	               .attr("y", function(d) {
	                    return yScale2(d[1]);
	               })
	               .attr('font-family', 'sans-serif')
                   .attr('font-size', '12px')
                   .style('font-weight', 'bold')
                   .style('fill', function(d) {
                   		return colorFill[d[2]];
                   });

                svg.append("text")             
				      .attr("transform",
				            "translate(" + w / 1.85 + " ," + 
				                           padding / 2 + ")")
				      .style("text-anchor", "middle")
				      .text("1955");


				svg.append("text")             
				      .attr("transform",
				            "translate(" + w / 6.5 + " ," + 
				                           padding / 2 + ")")
				      .style("text-anchor", "middle")
				      .text("1950");
	                        

	            svg.selectAll("line")
	            	.data(prepare)
	            	.enter()
	            	.append("line")
	            	.attr("x1", function(d) {
	            		if (d[0] == 1955) {
	                    	return xScale(d[0]);
	                    } else {
	                    	return xScale(d[0]) + 100;
	                    }
	                })
	                .attr("y1", function(d) {
	                    return yScale2(d[1]);
	                })
	                .attr("x2", function(d, i) {
	                	if (i < prepare.length - 1) {
	                		if (d[2] == prepare[i + 1][2]) {
		                		return xScale(prepare[i + 1][0]);
		                	} else {
		                		return xScale(d[0]);
	                		}
	                	} else {
		                		return xScale(d[0]);
	                	}
	                	
	                })
	                .attr("y2", function(d, i) {
	                	if (i < prepare.length - 1) {
		                	if (d[2] == prepare[i + 1][2]) {
		                		return yScale2(prepare[i + 1][1]);
		                	} else {
		                		return yScale2(d[1]);
		                	}
	                	} else {
		                		return yScale2(d[1]);
		                }
	                })
	                .attr("stroke-width", 2)
	                .attr("stroke", function(d) {
	               		return colorFill[d[2]];
	                });

	            
	        }

            </script>
    </body>

</html>